package dao_module;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.Locale;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

import model.Cineplex;
import model.Movie;
import model.Showtime;

public class ShowTimeDAO extends JSONDAO{
	private JSONObject jsonObject = null;
	private ArrayList<Showtime> showtimes = null;
	
	public ShowTimeDAO(){
		this.jsonObject = readFile(JSONDAO.showtimePath);
		parseJSON(this.jsonObject);
	}
	
	//@purpose	: create a new showtime
	//@param	: required
	//@return	: void
	public void createNewShowTime(Showtime showTime){
		//TODO update the showtime in jsonobject
		
		updateFile(JSONDAO.showtimePath,this.jsonObject);
	}
	//@purpose	: update a new showtime
	//@param	: required
	//@return	: void
	public void updateShowTime(Showtime showtime){
		//TODO update the showtime in jsonobject
		
		updateFile(JSONDAO.showtimePath,this.jsonObject);
	}
	
	//@purpose	: retrieve showtimes by cineplex n movie
	//@param	: required
	//@return	: void
	public ArrayList<Showtime> getShowTimesByCineplexAndMovie(Cineplex cineplex, Movie movie){
		ArrayList<Showtime> results = null;
		
//		if(this.showtimes!=null&&this.showtimes.size()>0){
//			for(int i=0;i<this.showtimes.size();i++){
//				if(this.showtimes.get(i).getMovie().equals(movie)){
//					//new CineplexDAO().getCineplexWithMovies(false)
//				}
//			}
//		}
		
		
		return results;
	}
	
	
	
	
	private void parseJSON(JSONObject jsonObject){
		if(this.jsonObject != null){
			JSONArray jsonShowTimes = (JSONArray) jsonObject.get("showtimes");
			JSONObject jsonShowTime;
			Showtime showtime;
			for(int i=0;i<jsonShowTimes.size();i++){
				jsonShowTime = (JSONObject)jsonShowTimes.get(i);
				showtime= new Showtime();
				
				showtime.setId(jsonShowTime.get("showtimeid").toString());
				showtime.setCineplexName(jsonShowTime.get("cineplexname").toString());
				showtime.setCinemaCode(jsonShowTime.get("cinemacode").toString());
				showtime.setMovieId(jsonShowTime.get("movieid").toString());
				
				DateFormat format = new SimpleDateFormat("yyyy-MM-dd-:hh:mm", Locale.ENGLISH);
				Date date = null;
				try {
					date = format.parse(jsonShowTime.get("datetime").toString());
				} catch (ParseException e) {
					e.printStackTrace();
				}
				showtime.setDateTime(date);
				showtime.setCinema(new CinemaDAO().getCinemaByCinemaId(showtime.getCinemaCode()));
				showtime.setMovie(new MovieDAO().getMovieByid(showtime.getMovieId()));
				
				
				if(this.showtimes==null)
					this.showtimes = new ArrayList<Showtime>();
				
			}
		}
	}
	
}
