package dao_module;
import java.util.ArrayList;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

import model.Booking;
import model.Guest;
import model.Review;

public class GuestDAO extends JSONDAO{
	private JSONObject jsonObject = null;
	private ArrayList<Guest> guests;
	
	public GuestDAO(){
		this.jsonObject = readFile(JSONDAO.guestPath);
		parseJSON(this.jsonObject);
	}
	
	
	//@purpose	: create a new guest data
	//@param		: required
	public void createNewGuest(Guest guest){
		//TODO add the Guess object in json object
		
		updateFile(JSONDAO.guestPath, this.jsonObject);
	}
	
	//@purpose	: get Guest details by email & mobileNo
	//@param	: required
	//@return	: return null if not found/exist
	public Guest getGuestByEmailAndMobileNo(String email, int mobileNo){
		Guest result = null;
		if(this.guests!=null&&this.guests.size()>0){
			for(int i=0;i<this.guests.size();i++){
				if(this.guests.get(i).getEmail().equals(email)&&this.guests.get(i).getMobileNo()==mobileNo){
					result = this.guests.get(i);
				}
			}
		}
		return result;
	}
	
	//@purpose	: get Guest details by id
	//@param	: required
	//@return	: return null if not found/exist
	public Guest getGuestById(String id){
		Guest result = null;
		if(this.guests!=null&&this.guests.size()>0){
			for(int i=0;i<this.guests.size();i++){
				if(this.guests.get(i).getId().equals(id)){
					result = this.guests.get(i);
				}
			}
		}
		return result;
	}
	
	//@purpose	: get Guest details with booking history
	//@param	: required
	//@return	: return null if guest not found/exist
	public Guest getGuestWithBookingDetails(String email, int mobileNo){
		Guest result = null;
		result = getGuestByEmailAndMobileNo(email, mobileNo);
		result.setBookings(new BookingDAO().getBookingsByGuest(result));
		return result;
	}
	
	private void parseJSON(JSONObject jsonObject){
		if(this.jsonObject != null){
			JSONArray jsonGuests = (JSONArray) jsonObject.get("guests");
			JSONObject jsonGuest;
			Guest guest;
			for(int i=0;i<jsonGuests.size();i++){
				jsonGuest = (JSONObject)jsonGuests.get(i);
				if(this.guests==null)
					this.guests = new ArrayList<Guest>();
				guest = new Guest();
				guest.setId(jsonGuest.get("id").toString());
				guest.setName(jsonGuest.get("name").toString());
				guest.setEmail(jsonGuest.get("email").toString());
				guest.setCineplexName(jsonGuest.get("cineplexname").toString());
				guest.setMobileNo(Integer.parseInt(jsonGuest.get("mobileno").toString()));
				guest.setBookings(new BookingDAO().getBookingsByGuest(guest));
				this.guests.add(guest);
			}
			
		}
	}
}
