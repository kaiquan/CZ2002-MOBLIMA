package dao_module;

import java.util.ArrayList;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

import model.MOVIESTATUS;
import model.Movie;

public class MovieDAO extends JSONDAO{
	private JSONObject jsonObject = null;
	private ArrayList<Movie> movies = null;
	
	public MovieDAO(){
		this.jsonObject = readFile(JSONDAO.moviePath);
		parseJSON(this.jsonObject);
	}
	
	//@purpose	: create a movie listing with reviews
	//@param	: required
	//@return	: void
	public void createNewMovie(Movie movie){
		//TODO update the movie json object
		
		updateFile(JSONDAO.moviePath,this.jsonObject);
	}
	
	//@purpose	: update the movie listing with reviews
	//@param	: required
	//@return	: void
	public void updateMovie(Movie movie){
		//TODO update the movie json object
		
		updateFile(JSONDAO.moviePath,this.jsonObject);
	}
	
	//@purpose	: retrieve the movie listing with reviews
	//@param	: required
	//@return	: arraylist of movies
	@SuppressWarnings("null")
	public ArrayList<Movie> getAllMovieswithReviews(boolean include_END_OF_SHOWING){
		ArrayList<Movie> results = null;
		
		if(this.movies!=null&&this.movies.size()>0){
			for(int i = 0;i<this.movies.size();i++){
				if(include_END_OF_SHOWING){
					results.add(this.movies.get(i));
				}
				else{
					if(this.movies.get(i).getMovieStatus()!=MOVIESTATUS.END_OF_SHOWING){
						results.add(this.movies.get(i));
					}
				}
			}
		}
		return results;
	}
	
	//@purpose	: retrieve the movie listing with reviews by cineplex
	//@param	: required
	//@return	: arraylist of movies
	public ArrayList<Movie> getAllMoviesWithReviewsByCineplex(String cineplexName, boolean include_END_OF_SHOWING){
		ArrayList<Movie> results = null;
		
		if(this.movies!=null&&this.movies.size()>0){
			
		}
			
		return results;
	}
	
	public Movie getMovieByid(String id){
		Movie result= null;
		return result;
	}
	
	
	private void parseJSON(JSONObject jsonObject){
		if(this.jsonObject != null){
			JSONArray jsonMovies = (JSONArray) jsonObject.get("movies");
			JSONObject jsonMovie;
			Movie movie;
			for(int i=0;i<jsonMovies.size();i++){
				jsonMovie = (JSONObject)jsonMovies.get(i);
				movie = new Movie();
				
				//loop to get the casts
				JSONArray jsonCasts = (JSONArray) jsonObject.get("casts");
				
				//loop to get the reviews
				
				
				if(this.movies==null)
					this.movies = new ArrayList<Movie>();
			}
		}
	}
}
